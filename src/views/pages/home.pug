extends ../layouts/main.pug

block content
  .hero-section
    .container
      h1 Discover your perfect stay around the globe
      p Enter your dates to see the latest prices and begin your journey of relaxation and adventure today.
      .search-box
        .row.align-items-center
          .col-md-3
            input.form-control(type="text" placeholder="Pune" value="Pune")
          .col-md-3
            input.form-control(type="date" placeholder="Check-in")
          .col-md-3
            input.form-control(type="date" placeholder="Check-out")
          .col-md-2
            input.form-control(type="number" placeholder="No. Of Guests")
          .col-md-1
            button.search-button SEARCH

  .container.my-5
    h2.text-center.mb-4 Book Hotels at Popular Destinations
    .row
      each destination in ['Mumbai', 'Bangkok', 'London', 'Dubai', 'Oslo']
        .col
          .destination-card
            img(src='https://placehold.co/150x150' alt=destination)
            p.mt-2= destination

  .container.my-5
    .row
      //- Left sidebar with filters
      .col-md-3
        .filter-sidebar.p-3.border.rounded
          .d-flex.justify-content-between.align-items-center.mb-3
            h5.m-0.fw-bold FILTERS
            button.btn.btn-sm.btn-outline-secondary(type="button" onclick="window.location.href='/'") Clear
          hr.my-2

          form#filterForm(method="get" action="/")
            input(type="hidden" name="page" value=currentPage)
            input(type="hidden" name="sortBy" value=sortBy)

            h6.mb-2.fw-bold Star ratings
            .mb-3
              .form-check
                input.form-check-input(type="checkbox" name="starRatings" value="5" id="5star" onchange="this.form.submit()" checked=starRatings && starRatings.includes(5))
                label.form-check-label(for="5star") 5 Star
              .form-check
                input.form-check-input(type="checkbox" name="starRatings" value="4" id="4star" onchange="this.form.submit()" checked=starRatings && starRatings.includes(4))
                label.form-check-label(for="4star") 4 Star
              .form-check
                input.form-check-input(type="checkbox" name="starRatings" value="3" id="3star" onchange="this.form.submit()" checked=starRatings && starRatings.includes(3))
                label.form-check-label(for="3star") 3 Star
              .form-check
                input.form-check-input(type="checkbox" name="starRatings" value="2" id="2star" onchange="this.form.submit()" checked=starRatings && starRatings.includes(2))
                label.form-check-label(for="2star") 2 Star
              .form-check
                input.form-check-input(type="checkbox" name="starRatings" value="1" id="1star" onchange="this.form.submit()" checked=starRatings && starRatings.includes(1))
                label.form-check-label(for="1star") 1 Star

            hr.my-2

            h6.mb-2.fw-bold Room types
            .mb-3
              each category in categories
                .form-check
                  input.form-check-input(type="checkbox" name="roomTypes" value=category.id id=`cat-${category.id}` onchange="this.form.submit()" checked=roomTypes && roomTypes.includes(category.id))
                  label.form-check-label(for=`cat-${category.id}`) #{category.name}
            hr.my-2

            h6.mb-2.fw-bold Price range
            .mb-3
              input.form-range(type="range" name="priceRange" min=minPrice max=maxPrice step="5" value=priceRange || maxPrice onchange="this.form.submit()")
              .d-flex.justify-content-between
                span $#{minPrice}
                span $#{maxPrice}

      //- Right side with rooms list
      .col-md-9
        .d-flex.justify-content-between.align-items-center.mb-4
          h2#room-list Handpicked nearby rooms for you
          .sort-dropdown
            form(method="get") 
              input(type="hidden", name="page", value=currentPage)
              select.form-select(name='sortBy', onchange='this.form.submit()')
                option(value='', selected=sortBy===undefined) Sort by
                option(value='Price: Low to High', selected=sortBy==='Price: Low to High') Price: Low to High
                option(value='Price: High to Low', selected=sortBy==='Price: High to Low') Price: High to Low
                option(value='Rating: Low to High', selected=sortBy==='Price: Low to High') Rating: Low to High
                option(value='Rating: High to Low', selected=sortBy==='Rating: High to Low') Rating: High to Low
        script.
          var rooms = !{JSON.stringify(rooms, null, 2)}
          console.log("Rooms data:", rooms)
        each room in rooms
          .hotel-card.mb-4.p-3.border.rounded.shadow-sm
            .row
              .col-md-3
                img.hotel-image.img-fluid.rounded(src=(room.images && room.images.length > 0) ? room.images[0].image_url : '/img/default.png', alt=room.name)
              .col-md-7
                h4.mb-2= room.name
                p.text-muted.mb-3 Capacity: #{room.max_guests || '1'} | #{room.category.name || 'Standard'}
                p.text-muted.mb-1= room.hotel.address || 'Location information'
                .features
                  p.feature-check.mb-1= room.status || 'Location information'
                  p.feature-check.mb-1 ✓ No prepayment needed | ✓ Free cancellation
              .col-md-2.text-end.d-flex.flex-column.justify-content-between
                .rating.d-flex.flex-column.align-items-end
                  span.star-rating.badge.bg-primary.p-2= room.hotel.averageRating + ' ★'
                  button.wishlist-btn.mt-2
                .price-section.mt-3
                  p.price.fw-bold.mb-1 $#{room.price ? room.price.amount : 18900}
                  button.btn.btn-warning.w-100(onclick=`window.location.href='/room/${room.id}'`) View Detail

        .pagination.d-flex.justify-content-center.mt-4
          if totalPages > 1
            nav(aria-label="Page navigation")
              ul.pagination.justify-content-center
                li.page-item(class=currentPage === 1 ? 'disabled' : '')
                  a.page-link(href="#" data-page=currentPage - 1) Previous
                each pageNum in Array(totalPages).fill().map((_, i) => i + 1)
                  li.page-item(class=currentPage === pageNum ? 'active' : '')
                    a.page-link(href="#" data-page=pageNum) #{pageNum}
                li.page-item(class=currentPage === totalPages ? 'disabled' : '')
                  a.page-link(href="#" data-page=currentPage + 1) Next
        script.
          window.onload = function() {
            var urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('sortBy')) {
              var roomList = document.getElementById('room-list');
              if (roomList) {
                roomList.scrollIntoView({ behavior: 'smooth' });
              }
            }
            const pageLinks = document.querySelectorAll('.page-link');
            pageLinks.forEach(link => {
              link.addEventListener('click', (e) => {
                e.preventDefault();
                const pageNum = link.getAttribute('data-page');
                const pageInput = document.querySelector('input[name="page"]');
                const form = document.getElementById('filterForm');
                if (pageInput && form) {
                  pageInput.value = pageNum;
                  form.submit();
                } else {
                  console.error('Form or page input not found');
                }
              });
            });
          };

