extends ../layouts/main.pug

block content
    .container.my-4
      #user-information.row(if=user, data-user-id=`${user ? user.id : ''}`)
        .col-md-8
          .card.mb-4
            img.card-img-top(src=(room.images && room.images.length > 0) ? room.images[0].image_url : '/img/default.png', alt=room.name)
            .card-body
              .d-flex.align-items-center.mb-2
                h2.card-title.mb-0= room.name
                .hotel-rating.ms-3
                  i.fas.fa-star
                  i.fas.fa-star
                  i.fas.fa-star
                  i.fas.fa-star
                  i.fas.fa-star
              p.text-muted= room.hotel.address
              p.card-text
                A= room.description
              ul.list-unstyled
          .card
            .card-body
              .d-flex.justify-content-between.align-items-center.mb-4
                h3 User Reviews
                button.btn.btn-primary Write a Review
              .mb-4
                h4 Overall Rating: 3.5/5
                p.text-muted Based on 15 reviews

                .mb-2
                  span.review-count 5 
                  .progress.review-progress
                    .progress-bar.review-progress-bar(style="width: 20%")
                  span.review-count.ms-2 3
                .mb-2
                  span.review-count 4 
                  .progress.review-progress
                    .progress-bar.review-progress-bar(style="width: 40%")
                  span.review-count.ms-2 6
                .mb-2
                  span.review-count 3 
                  .progress.review-progress
                    .progress-bar.review-progress-bar(style="width: 60%")
                  span.review-count.ms-2 9
                .mb-2
                  span.review-count 2 
                  .progress.review-progress
                    .progress-bar.review-progress-bar(style="width: 80%")
                  span.review-count.ms-2 12
                .mb-2
                  span.review-count 1 
                  .progress.review-progress
                    .progress-bar.review-progress-bar(style="width: 100%")
                  span.review-count.ms-2 15

              .user-review
                .d-flex.align-items-center.mb-2
                  .user-avatar.me-2
                    i.fas.fa-user
                  .d-flex.flex-column
                    h5.mb-0 Rahul Patel
                    small.text-muted Date of stay: 2021-01-01
                  .hotel-rating.ms-auto
                    i.fas.fa-star
                    i.fas.fa-star
                    i.fas.fa-star
                    i.fas.fa-star
                    i.fas.fa-star
                p
                  The hotel is very good and the staff is very friendly. The food is also very good.
        script.
          var room = !{JSON.stringify(room, null, 2)}
          var services = !{JSON.stringify(services, null, 2)}
          console.log("Rooms data:", room)
          console.log("Services data:", services)
        .col-md-4
          .card
            .card-header.bg-primary.text-white
              h4 Booking Details
            .card-body
              .mb-3
                h5 Total Price
                h4#totalPrice.text-primary $#{room.price ? room.price.amount : 18900}
                small.text-success Free cancellation 1 day prior to stay
              .mb-3
                h5 CheckIn & CheckOut Date
                input#checkIn.form-control.mb-2(type="date")
                input#checkOut.form-control(type="date" value="")
              .mb-3
                h5 Reservations
                select.form-select
                  each num in Array.from({ length: room.max_guests }, (_, i) => i + 1)
                    option #{num} guest#{num > 1 ? 's' : ''}
              .mb-3
                h5 Room Type
                select.form-select
                  option #{room.category.name ? room.category.name : 'Single Room'} 
              .mb-3
                h5 Additional Services
                each service in services
                  .form-check
                    input.form-check-input.service-checkbox(type="checkbox" id=`service-${service.id}` name="services[]" value=(service.prices && service.prices.length > 0 ? service.prices[0].amount : 'N/A') data-service-id=service.id)
                    label.form-check-label(for=`service-${service.id}`) 
                      | #{service.name} - $#{service.prices && service.prices.length > 0 ? service.prices[0].amount : 'N/A'}
                small.text-muted.d-block.mt-2 Book now, You wonâ€™t be charged yet!
              button.btn.btn-warning.w-100  Book Now
    script.
      document.addEventListener("DOMContentLoaded", function() {
        let today = new Date().toISOString().split("T")[0]; 
        let checkIn = document.getElementById("checkIn");
        let checkOut = document.getElementById("checkOut");

        // Set min cho Check-in
        checkIn.setAttribute("min", today);
        checkIn.value = today;

        // Set min cho Check-out
        checkOut.setAttribute("min", today);

        // When Check-in changes
        checkIn.addEventListener("change", function() {
          let checkInDate = checkIn.value;

          // Set min cho Check-out
          checkOut.setAttribute("min", checkInDate);

          // If Check-out < Check-in
          if (checkOut.value && checkOut.value <= checkInDate) {
            alert("Check-out date must be later than Check-in date!");
            checkOut.value = "";
          }
        });

        // When Check-out changes
        checkOut.addEventListener("change", function() {
          if (checkOut.value <= checkIn.value) {
            alert("Check-out date must be later than Check-in date!");
            checkOut.value = ""; // Reset if Check-out < Check-in
          }
        });
        // Calculate total price
        let basePrice = #{room.price ? room.price.amount : 18900};
        let totalPriceElement = document.getElementById("totalPrice");
        
        function updateTotalPrice() {
          let total = basePrice;
          document.querySelectorAll(".service-checkbox:checked").forEach((checkbox) => {
            total += parseFloat(checkbox.value); // Add service price
          });
          totalPriceElement.textContent = `$${total.toFixed(2)}`;; // Update total price
        }

        // Add event listener to service checkboxes
        document.querySelectorAll(".service-checkbox").forEach((checkbox) => {
          checkbox.addEventListener("change", updateTotalPrice);
        });
      });

